# Defines INSERT/UPSERT patterns and table schemas for all tables in the DAGs

tables:
  raw_github_contributions:
    schema:
      columns:
        username:
          type: VARCHAR(255)
          not_null: true
        date:
          type: DATE
          not_null: true
        contribution_count:
          type: INTEGER
          not_null: true
      primary_key:
        - username
        - date
    upsert:
      type: on_conflict
      conflict_keys:
        - username
        - date
      update_fields:
        contribution_count: EXCLUDED.contribution_count
    method: executemany

  raw_github_pulls:
    schema:
      columns:
        repo_name:
          type: VARCHAR(255)
          not_null: true
        pr_id:
          type: BIGINT
          not_null: true
        state:
          type: VARCHAR(50)
          not_null: false
        created_at:
          type: TIMESTAMP
          not_null: false
        merged_at:
          type: TIMESTAMP
          not_null: false
        user_login:
          type: VARCHAR(255)
          not_null: false
      primary_key:
        - pr_id
    upsert:
      type: replace_index
      conflict_key: pr_id
    method: insert_rows

